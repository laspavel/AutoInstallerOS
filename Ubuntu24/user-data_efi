#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: ubuntu-server
    username: admin
    # crypt password (mkpasswd -m sha512crypt or openssl passwd -6 sun_password)
    password: "$6$CedBC5FogKlSBKRZ$QIk11vkJCsFVUDgCtV58CvaUI9ScIJT4Bfgs4f2hXxsYKV4t5j37bz/kDeXbPY4MZmkGCMWKC9V/Heqhzl3gU0"
  storage:
    swap:
      size: 0
    config:
    - id: disk0
      type: disk
      path: /dev/sda
      wipe: superblock
      grub_device: true
      ptable: gpt
      preserve: false
    - type: part0
      id: partition-0
      device: disk0
      size: 4194304
      wipe: superblock
      flag: bios_grub
      preserve: false
      grub_device: false
    # EFI Partition (обязательно для UEFI)
    - id: efi-part
      type: partition
      size: 100MB
      device: disk0
      flag: boot
      grub_device: true
    - id: efi-format
      type: format
      fstype: fat32
      volume: efi-part
    - id: efi-mount
      type: mount
      path: /boot/efi
      device: efi-format
    # Root Partition
    - id: root-part
      type: partition
      size: -1
      device: disk0
    - id: root-format
      type: format
      fstype: ext4
      volume: root-part
    - id: root-mount
      type: mount
      path: /
      device: root-format
  packages:
    - openssh-server
    - mc
    - nano
    - net-tools
    - git
    - tig
    - htop
    - sysstat
    - ncdu
  ssh:
    install-server: true
  late-commands:
  - curtin in-target -- /usr/bin/sed -i '/^#PermitRootLogin/ s/^#//; /PermitRootLogin/! s/^$/PermitRootLogin yes/' /etc/ssh/sshd_config
  - curtin in-target -- /bin/bash -c "echo -e '123123Q\n123123Q' | passwd root"
  - curtin in-target -- /usr/bin/systemctl enable ssh
  locale: en_US.UTF-8
  timezone: "Europe/Kyiv"
  keyboard:
    layout: us
  network:
    network:
      version: 2
      ethernets:
        enp0s3:
          dhcp4: true
